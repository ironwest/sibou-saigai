# 労働災害－死亡災害オープンデータレポジトリ

厚生労働省のオープンデータ（労働災害－死亡災害）のスクレイピング、前処理、Shinyアプリ化に関するGihubレポジトリです。以下、背景、目的は学会発表で利用した下書きなので少し硬い文章であること、ご容赦ください。）

## 背景

厚生労働省の公開データとして、労働災害の死亡災害のデータは[職場のあんぜんサイト](https://anzeninfo.mhlw.go.jp/anzen_pg/SIB_FND.html)で公開されています。しかし、公開されているファイルは、

* エクセルファイルであり開くために特定のソフトウェアに依存している
* 複数年度のデータの結合が難しい
    * 2行に渡った列名
    * 列名内の一部にルの結合が行われている
* 表記ゆれがある
    * 入力ミスと思われる各種コード
    * 提供されているマスターデータ（職場のあんぜんサイトでWordファイルで提供）を使っても・・・
        * コードと名前が一致しない（一つのコードに保健衛生、保健・衛生、保健衛生業など微妙に違うバリエーションが存在する）    
        * コードに表記ゆれが存在する(1と01の混在など)
    * マスターがない列で年度毎に微妙に記載されている範囲が違う
        * 発生時間が0～1、1～2などの1刻みの年度と、0～2、2～4などの2刻みの年度の混在
        * 事業場規模が、0～9としてある年度と、0と1～9と分かれている年度の混在
        * 事業場規模が300～としかかかれておらず、他の、300～499、500～・・・と細かく分かれている年度と結合しようとするとうまくいかない

等、多数の問題があり、分析や利活用するための形とするには一定程度のデータ加工（前処理）のスキルが必要です。

先行研究[^1]では、上記の問題の一部について解決されて、解決された、より機械判読に適した形のCSVファイルが成果物として[労働安全衛生総合研究所のウェブサイト](https://www.jniosh.johas.go.jp/publication/houkoku/houkoku_2022_01.html)に公開されているが、

* CSVファイルが年度毎に分かれている
* 平成3年から30年のデータまでしか公開されていない
* 上記の問題で結合した場合に範囲などの整合性がとれない問題は対応されていない(一部、300～を300～499と置き換えているなど誤分類の可能性のあるデータがある)
* 具体的にどのような手順でデータ加工されたかの情報が公開されていない

などから、データを利用しようとした場合にデータ結合の手間が発生することや、最新の情報を含むためにはもとのエクセルファイルの処理が必要となるものの、その処理の行い方がわからないため、各企業の安全衛生担当者が自社の安全衛生活動に利用しようとした場合に大きな困難が伴う状況は持続していると考えられる。）

## 目的

背景の状況にあることから、このレポジトリでは、

* 平成3年から令和4年度(2023年時点の最新分)までのエクセルファイルを一つにしたCSVを作成すること
* 全ての年度で可能な限り誤分類を減らすような処理を行うこと
* CSVを作成する工程をウェブスクレイピングから出力までを全てR言語で実施し、そのスクリプトを本レポジトリに公開すること
* R Shinyで簡易的に集計・事例抽出を行うアプリケーションを作成してShinyapps.ioへ公開、そのスクリプトを本レポジトリに公開すること

を目的としている。

とくに、Rスクリプトを全て公開することで、製作者が意図していないミスや、見落としていた誤分類などの指摘・改善を通して、より使いやすいデータセットになる可能性に期待している。また、アプリケーションを公開することで、PC操作が得意でない各企業の労働安全衛生担当者が自社での死亡事故のリスク低減の一助になれば、幸甚である。


[^1]: 濱島 京子, 機械判読の観点からみた労働災害データベースの課題, 労働安全衛生研究, 2022, 15 巻, 2 号, p. 177-188, 公開日 2022/09/30, [早期公開] 公開日 2022/07/26, Online ISSN 1883-678X, Print ISSN 1882-6822, https://doi.org/10.2486/josh.JOSH-2022-0009-CHO, https://www.jstage.jst.go.jp/article/josh/15/2/15_JOSH-2022-0009-CHO/_article/-char/ja


## 各ファイルの説明

大まかには、

* `scraping_sibou.R`で、
    * 職場のあんぜんサイトからのエクセルファイルの`dldata_sibou`フォルダへのダウンロード
    * 各種前処理(`sibou_codes.xlsx`に含まれるコードと名前の対応表をもとにした置き換えなど)
    * 結果の`死亡データ_統合.csv`への出力
    * 結果をshinyアプリで利用するために便利な形式、`death_by_accident_data.rds`での出力

* `sibou_codes.xlsx`は、[職場のあんぜんサイトで公開されているWordファイル](https://anzeninfo.mhlw.go.jp/anzen_pg/rousai_db_siyou1109.doc)、`rousai_db_siyou1109.doc`のマスターデータと思われる表を3つのシートに分けて保存したものになります。(この表の作成にもRでWordファイルから作成するべきでしたが、手間の観点から手作業としています。)

* `sibou_app.R`が、Shinyapps.io上で動作しているアプリの本体です。動作に必要な別のファイルは`death_by_accident_data.rds`のみとなります。

`scraping_sibou.R`がデータの前処理工程全てになります。コメントは適宜つけていますが、メモ程度です。